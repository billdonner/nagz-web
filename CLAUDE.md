# Nagz Web App

## Stack
- React, TypeScript, Vite
- API client auto-generated by orval from openapi.json
- Testing: vitest + @testing-library/react + jsdom

## Deployment
- **Live URL:** https://bd-nagzerver.fly.dev (embedded in nagzerver Docker image)
- Built in a multi-stage Dockerfile: Node stage runs `npx vite build` with `VITE_API_URL=""`
- The built `dist/` is copied into the nagzerver Python container as `/app/static-web`
- Deploy via `~/Flyz/scripts/deploy.sh nagzerver` (auto-bundles nagz-web source)

## Common Commands
- `npm run dev` — start dev server (port 5173)
- `npm run api:generate` — regenerate TypeScript API client from openapi.json
- `npm run build` — production build (runs `tsc -b && vite build`)
- `npx vite build` — production build without type-checking (used in Docker)
- `npx vitest run` — run tests

## Cross-Project Sync
After any change to UI behavior or features:
- Always check if `~/nagz-ios` needs a matching update
- When openapi.json is updated from nagzerver, run `npm run api:generate` to regenerate the TypeScript client

## Architecture
- `ErrorBoundary` — React class component wrapping the entire app
- `extractErrorMessage()` — utility in `axios-instance.ts` for consistent error handling
- Axios response interceptor dispatches `nagz:unauthorized` event on 401 (AuthProvider listens and logs out via React state)
- 30s timeout on all API requests
- `AuthProvider` wraps the app, stores JWT in sessionStorage (not localStorage)
- `VersionProvider` checks API compatibility on mount

## Testing Notes
- vitest with jsdom environment (configured in vite.config.ts)
- Use `vi.stubGlobal("sessionStorage", mock)` for auth token mocking, `vi.stubGlobal("localStorage", mock)` for familyId
- Test files go in `src/__tests__/`

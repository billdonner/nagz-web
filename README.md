# Nagz Web

React/TypeScript web client for **Nagz**, a family-oriented AI-mediated nagging/reminder app.

## Stack

- [React](https://react.dev/) 19, TypeScript, [Vite](https://vite.dev/)
- [React Router](https://reactrouter.com/) v7
- [Axios](https://axios-http.com/) for HTTP requests
- API client auto-generated by [Orval](https://orval.dev/) from `openapi.json`
- Testing: [Vitest](https://vitest.dev/) + [Testing Library](https://testing-library.com/) + jsdom

## Quick Start

```bash
npm install
npm run dev
```

The dev server proxies to the API at `http://127.0.0.1:8001/api/v1`.

## Project Structure

| Path | Description |
|------|-------------|
| `src/components/` | UI components (Login, NagList, FamilyDashboard, Policies, Reports, etc.) |
| `src/api/` | Axios instance and auto-generated API client (endpoints + models) |
| `src/auth.tsx` | AuthProvider — JWT stored in localStorage |
| `src/version.tsx` | VersionProvider — API compatibility check on mount |
| `src/__tests__/` | Vitest test suite |
| `openapi.json` | OpenAPI spec (copied from nagzerver) |
| `orval.config.ts` | Orval code-generation config |

## Commands

```bash
npm run dev            # Start dev server
npm run build          # Production build
npm run lint           # ESLint
npm run api:generate   # Regenerate TypeScript API client from openapi.json
npx vitest run         # Run tests (105)
```

## API Client Workflow

When the server API changes:

1. Regenerate `openapi.json` in nagzerver and copy it here
2. Run `npm run api:generate` to update the TypeScript client in `src/api/`

## AI Features

The web client uses **server-side AI endpoints** for all AI features (no on-device processing). The iOS app handles AI on-device when possible via Apple Intelligence; the web client always calls the server.

| Feature | Endpoint | Description |
|---------|----------|-------------|
| Excuse summarization | `POST /ai/summarize-excuse` | Categorize and summarize excuse text |
| Tone selection | `POST /ai/select-tone` | Choose escalation tone based on history |
| Coaching tips | `POST /ai/coaching` | Motivational tips for nag recipients |
| Behavioral patterns | `GET /ai/patterns` | Detect miss patterns (day-of-week, etc.) |
| Weekly digest | `GET /ai/digest` | Family completion summary |
| Completion prediction | `GET /ai/predict-completion` | Likelihood + optimal reminder time |
| Push-back evaluation | `POST /ai/push-back` | Evaluate whether to push back on excuses |

All AI endpoints require `ai_mediation` consent and the `ai_server_enabled` user preference. V1 uses deterministic heuristics; upgradable to LLM without API changes.

## Architecture

- `AuthProvider` wraps the app, stores JWT in localStorage
- `VersionProvider` checks API compatibility on mount
- `ErrorBoundary` catches unhandled errors app-wide
- Axios interceptor auto-logs out on 401; 30s request timeout
- `extractErrorMessage()` utility for consistent error display

## Related Repos

| Repo | Description |
|------|-------------|
| [nagzerver](https://github.com/billdonner/nagzerver) | Python API server (source of truth) |
| [nagz-ios](https://github.com/billdonner/nagz-ios) | SwiftUI iOS client |
| [nagz](https://github.com/billdonner/nagz) | Specs and documentation |
